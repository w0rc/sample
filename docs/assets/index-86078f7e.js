var H=Object.defineProperty;var z=(d,e,n)=>e in d?H(d,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[e]=n;var k=(d,e,n)=>(z(d,typeof e!="symbol"?e+"":e,n),n),_=(d,e,n)=>{if(!e.has(d))throw TypeError("Cannot "+n)};var C=(d,e,n)=>(_(d,e,"read from private field"),n?n.call(d):e.get(d)),L=(d,e,n)=>{if(e.has(d))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(d):e.set(d,n)},B=(d,e,n,i)=>(_(d,e,"write to private field"),i?i.call(d,n):e.set(d,n),n);import{V as u,r as w,R as K,u as G,M as E,a as Q,B as Y,b as X,j as r,c as $,C as Z,O as J,d as ee,e as te}from"./vendor.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const b of a.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&i(b)}).observe(document,{childList:!0,subtree:!0});function n(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(l){if(l.ep)return;l.ep=!0;const a=n(l);fetch(l.href,a)}})();var I,D,q,N,P;class se{constructor(e,n=123456789,i=362436069,l=521288629){L(this,I,void 0);L(this,D,void 0);L(this,q,void 0);L(this,N,void 0);L(this,P,0);B(this,N,e===void 0?88675123:e>>>0),B(this,I,n>>>0),B(this,D,i>>>0),B(this,q,l>>>0);for(let a=0;a<32;a++)this.gen()}gen(){return B(this,P,C(this,I)^C(this,I)<<11),B(this,I,C(this,D)),B(this,D,C(this,q)),B(this,q,C(this,N)),B(this,N,(C(this,N)^C(this,N)>>>19^(C(this,P)^C(this,P)>>>8))>>>0),C(this,N)}rand(){return this.gen()/4294967296}range(e=0,n=10){return this.rand()*(n-e)+e}shuffle(e){const n=[];for(let i=0,l=0,a=e.length;i<a;i++)l=Math.floor(this.range(0,i)),n[i]=i!==l?n[l]:n[i],n[l]=e[i];return n}}I=new WeakMap,D=new WeakMap,q=new WeakMap,N=new WeakMap,P=new WeakMap;class ne{constructor(){k(this,"all");k(this,"notakes");k(this,"standard");k(this,"scramble");k(this,"vectors");k(this,"rotateAxes");const e=["R","L","U","D","F","B"],n=["M","E","S"],i=["x","y","z"],l=e.map(c=>c+"'"),a=e.map(c=>c+"2"),b=e.concat(l).concat(a),x=e.map(c=>c+"'2"),v=e.map(c=>c+"2'"),O=b.concat(x).concat(v),F=e.map(c=>c+"w"),A=e.map(c=>c+"'w"),s=e.map(c=>c+"w2"),R=F.concat(A).concat(s),W=e.map(c=>c+"'w2"),t=e.map(c=>c+"w2'"),m=R.concat(W).concat(t),g=n.map(c=>c+"'"),h=n.map(c=>c+"2"),o=n.concat(g).concat(h),f=n.map(c=>c+"'2"),p=n.map(c=>c+"2'"),M=o.concat(f).concat(p),S=i.map(c=>c+"'"),j=i.concat(S),y=i.map(c=>c+"2"),U=i.map(c=>c+"'2"),T=i.map(c=>c+"2'"),V=j.concat(y).concat(U).concat(T);this.all=Array.prototype.concat(O,M,m,V),this.notakes=Array.prototype.concat(O,M,m),this.standard=Array.prototype.concat(b,o,R,j),this.scramble=Array.prototype.concat(b),this.vectors=new Map([["R",new u(1,0,0)],["L",new u(-1,0,0)],["U",new u(0,1,0)],["D",new u(0,-1,0)],["F",new u(0,0,1)],["B",new u(0,0,-1)],["M",new u(-1,0,0)],["E",new u(0,-1,0)],["S",new u(0,0,1)],["x",new u(1,0,0)],["y",new u(0,1,0)],["z",new u(0,0,1)]]),this.rotateAxes=new Map([["R",new u(-1,0,0)],["L",new u(1,0,0)],["U",new u(0,-1,0)],["D",new u(0,1,0)],["F",new u(0,0,-1)],["B",new u(0,0,1)],["M",new u(1,0,0)],["E",new u(0,1,0)],["S",new u(0,0,-1)],["x",new u(-1,0,0)],["y",new u(0,-1,0)],["z",new u(0,0,-1)]])}getVector(e){const n=this.vectors.get(e);if(n)return n;throw new Error(e+" is not Rotation Symbol.")}getRotateAxis(e){const n=this.rotateAxes.get(e);if(n)return n;throw new Error(e+" is not Rotation Symbol.")}}const re=w.forwardRef(function(e,n){const i=new ne,l=new se(new Date().valueOf()),a=w.useRef(null),b=w.useRef(null),x=w.useRef("manual"),v=w.useRef({isRotation:!1,rotateSymbol:"",symbolVector:new u,currentAngle:0,targetAngle:0,rotateAxis:new u,history:[],rotateQueue:[]}),O=new K,F=w.useRef({mesh:null,tempMaterial:null}),{scene:A}=G();w.useEffect(()=>{const t=a.current;if(t){if(t.name!=="")return;{t.name="RubikCubeGroup";const m=.3,g=.8,h=!1,o=[new E({color:13382451,roughness:m,opacity:g,transparent:h}),new E({color:13395507,roughness:m,opacity:g,transparent:h}),new E({color:13421772,roughness:m,opacity:g,transparent:h}),new E({color:13421670,roughness:m,opacity:g,transparent:h}),new E({color:3394611,roughness:m,opacity:g,transparent:h}),new E({color:3355596,roughness:m,opacity:g,transparent:h})],f=3,p=-1,M=1.01;for(let S=0;S<f;S++)for(let j=0;j<f;j++)for(let y=0;y<f;y++){const U=new Q(new Y(1,1,1),o);U.position.set((S+p)*M+e.position.x,(j+p)*M+e.position.y,(y+p)*M+e.position.z),a.current.attach(U)}}}},[A,e]),X((t,m)=>{const g=a.current,h=v.current,o=F.current;if(g&&o){O.setFromCamera(new $(t.mouse.x,t.mouse.y),t.camera);const f=O.intersectObjects(g.children,!1);if(f.length>0){const p=f[0].object;o.mesh!==p&&(o.mesh&&o.mesh.material&&o.tempMaterial&&(o.mesh.material=o.tempMaterial),p.material&&(F.current={mesh:p,tempMaterial:p.material}),p.material=new E({color:16777215}))}else o.mesh&&o.tempMaterial&&(o.mesh.material=o.tempMaterial),F.current={mesh:null,tempMaterial:null}}if(g&&h)if(h.isRotation){const f=b.current;if(f){const p=m*e.moveSpeed;if(h.currentAngle+=p,f.rotateOnAxis(h.rotateAxis,p),h.currentAngle+p*1.5>h.targetAngle){f.rotateOnAxis(h.rotateAxis,h.targetAngle-h.currentAngle);const M=[];f.children.forEach(S=>{M.push(S)}),M.forEach(S=>{g.attach(S)}),h.isRotation=!1,e.onRotationFinished&&e.onRotationFinished(h.rotateSymbol)}}}else{const f=x.current;if(f==="manual"&&W(),f==="demo"&&s(l.shuffle(i.notakes).shift()),f==="order"||f==="reverse"){const p=v.current.rotateQueue.shift();p?s(p,f==="reverse"):(x.current="manual",e.onOrderFinished&&e.onOrderFinished())}}});const s=function(t,m){const g=i.all.find(f=>f===t);if(g===void 0){console.error("is NOT rotation symbol syntax:"+t);return}const h=a.current,o=v.current;if(h&&o)if(o.isRotation)console.log("rubikcube is busy.");else{o.rotateSymbol=g;const[f,...p]=o.rotateSymbol.split("");o.symbolVector=i.getVector(f),o.currentAngle=0,o.targetAngle=p.includes("2")?Math.PI:Math.PI*.5;const M=i.getRotateAxis(f);o.rotateAxis=p.includes("'")?M.negate():M;const S=b.current;if(S){const j=[];h.children.forEach(y=>{o.rotateSymbol.match(/[xyz]/)?j.push(y):o.rotateSymbol.match(/[w]/)?y.position.angleTo(o.symbolVector)<Math.PI*.526&&j.push(y):o.rotateSymbol.match(/[MES]/)?y.position.angleTo(o.symbolVector)>Math.PI*.476&&y.position.angleTo(o.symbolVector)<Math.PI*.526&&j.push(y):y.position.angleTo(o.symbolVector)<Math.PI*.476&&j.push(y)}),S.rotation.set(0,0,0),j.forEach(y=>{S.add(y)})}o.isRotation=!0,m?o.history.pop():o.history.push(o.rotateSymbol),e.onRotationStarted&&e.onRotationStarted(o.rotateSymbol),R.current.forEach((j,y)=>{y!=="w"&&y!=="W"&&R.current.set(y,!1)})}},R=w.useRef(new Map),W=()=>{const t=R.current;(t.get("w")||t.get("W"))&&t.get("r")&&s("Rw"),(t.get("w")||t.get("W"))&&t.get("l")&&s("Lw"),(t.get("w")||t.get("W"))&&t.get("u")&&s("Uw"),(t.get("w")||t.get("W"))&&t.get("d")&&s("Dw"),(t.get("w")||t.get("W"))&&t.get("f")&&s("Fw"),(t.get("w")||t.get("W"))&&t.get("b")&&s("Bw"),(t.get("w")||t.get("W"))&&t.get("R")&&s("R'w"),(t.get("w")||t.get("W"))&&t.get("L")&&s("L'w"),(t.get("w")||t.get("W"))&&t.get("U")&&s("U'w"),(t.get("w")||t.get("W"))&&t.get("D")&&s("D'w"),(t.get("w")||t.get("W"))&&t.get("F")&&s("F'w"),(t.get("w")||t.get("W"))&&t.get("B")&&s("B'w"),t.get("r")&&s("R"),t.get("l")&&s("L"),t.get("u")&&s("U"),t.get("d")&&s("D"),t.get("f")&&s("F"),t.get("b")&&s("B"),t.get("R")&&s("R'"),t.get("L")&&s("L'"),t.get("U")&&s("U'"),t.get("D")&&s("D'"),t.get("F")&&s("F'"),t.get("B")&&s("B'"),t.get("e")&&s("E"),t.get("m")&&s("M"),t.get("s")&&s("S"),t.get("E")&&s("E'"),t.get("M")&&s("M'"),t.get("S")&&s("S'"),t.get("x")&&s("x"),t.get("y")&&s("y"),t.get("z")&&s("z"),t.get("X")&&s("x'"),t.get("Y")&&s("y'"),t.get("Z")&&s("z'")};return w.useImperativeHandle(n,()=>{var t;return{onKeyDown:m=>{R.current.set(m,!0)},onKeyUp:m=>{R.current.set(m,!1)},setCubeMode:m=>{x.current=m},requestOrder:(...m)=>{var g;(g=v.current)==null||g.rotateQueue.push(...m),x.current="order",e.onOrderStarted&&e.onOrderStarted()},requestReverse:()=>{var g,h;const m=[...(g=v.current)==null?void 0:g.history].reverse().map(o=>o.indexOf("'")>0?o.replace("'",""):o.replace(/^(.)/,"$1'"));(h=v.current)==null||h.rotateQueue.push(...m),x.current="reverse",e.onOrderStarted&&e.onOrderStarted()},history:(t=v.current)==null?void 0:t.history}},[e]),r.jsxs(r.Fragment,{children:[r.jsx("group",{position:e.position,ref:a}),r.jsx("group",{position:e.position,ref:b})]})});const oe=w.forwardRef(function(e,n){const[i,l]=w.useState(!1),[a,b]=w.useState(!1),[x,v]=w.useState(!1),[O,F]=w.useState("");return w.useImperativeHandle(n,()=>({resetConsoles:()=>{b(!1),v(!1)}})),r.jsxs("div",{className:"Controller",children:[r.jsxs("div",{className:"table",children:[r.jsx("div",{children:r.jsx("label",{htmlFor:"speedInput",children:"Speed:"})}),r.jsx("div",{children:r.jsx("input",{type:"number",id:"speedInput",className:"speed",value:e.moveSpeed,onChange:A=>{const s=parseInt(A.target.value);isNaN(s)||s<=0?console.log("Speed must be >0."):e.requestSetSpeed(s)}})})]}),r.jsxs("div",{className:"inputSymbols",children:[r.jsx("label",{htmlFor:"inputSymbols",children:"InputSymbols:"}),r.jsx("br",{}),r.jsx("textarea",{id:"inputSymbols",value:O,onChange:A=>F(A.target.value)}),r.jsx("input",{type:"button",id:"orderBtn",value:"Order",className:x?"clicked":"",onClick:()=>{x||(e.requestOrder(O),e.requestModeChange("order")),v(!x)},disabled:i||x||a})]}),r.jsxs("div",{className:"history",children:[r.jsx("label",{htmlFor:"history",children:"History:"}),r.jsx("br",{}),r.jsx("textarea",{id:"history",value:e.history,readOnly:!0})]}),r.jsxs("div",{className:"table",children:[r.jsx("div",{children:r.jsx("label",{htmlFor:"demoBtn",children:"Demonstration:"})}),r.jsx("div",{children:r.jsx("input",{type:"button",id:"demoBtn",className:i?"clicked":"",value:i?"Stop":"Start",onClick:()=>{e.requestModeChange(i?"manual":"demo"),l(!i)},disabled:a||x})})]}),r.jsxs("div",{className:"table",children:[r.jsx("div",{children:r.jsx("label",{htmlFor:"reverseBtn",children:"Restore cube:"})}),r.jsx("div",{children:r.jsx("input",{type:"button",id:"reverseBtn",value:"Restore",className:a?"clicked":"",onClick:()=>{a||e.requestReverse(),b(!a)},disabled:i||x||a})})]})]})});function ie(){var A;const d=w.useRef(null),e=w.useRef(null),n=w.useRef(null),i=s=>{e.current&&e.current.onKeyDown(s.key)},l=s=>{e.current&&e.current.onKeyUp(s.key)},[a,b]=w.useState(4),[x,v]=w.useState(""),O=s=>{v(x+" "+s)},F=()=>{var s;(s=n.current)==null||s.resetConsoles()};return r.jsxs("div",{className:"App",children:[r.jsx("div",{className:"Canvas-Container",children:r.jsxs(Z,{className:"Canvas",tabIndex:0,onKeyDown:i,onKeyUp:l,camera:{position:new u(4,3.5,5)},ref:d,children:[r.jsx(J,{}),r.jsx("ambientLight",{intensity:1}),r.jsx("directionalLight",{position:[10,10,10],intensity:.8}),r.jsx("directionalLight",{position:[-10,-10,-10],intensity:.8}),r.jsx("directionalLight",{position:[10,10,10],intensity:.4}),r.jsx("directionalLight",{position:[10,-10,10],intensity:.4}),r.jsx("axesHelper",{args:[3]}),r.jsx("gridHelper",{args:[20,20],position:[0,-3,0]}),r.jsx("gridHelper",{args:[20,20],position:[0,7,-10],rotation:[Math.PI/2,0,0]}),r.jsx("gridHelper",{args:[20,20],position:[-10,7,0],rotation:[0,0,Math.PI/2]}),r.jsx(re,{position:new u(0,0,0),moveSpeed:a,onRotationFinished:O,onOrderFinished:F,ref:e})]})}),r.jsx(oe,{moveSpeed:a,requestSetSpeed:s=>b(s),requestModeChange:s=>{var R;(R=e.current)==null||R.setCubeMode(s)},requestOrder:s=>{var R;(R=e.current)==null||R.requestOrder(...s.split(" "))},requestReverse:()=>{var s;(s=e.current)==null||s.requestReverse()},history:(A=e.current)==null?void 0:A.history.join(" "),ref:n})]})}ee.createRoot(document.getElementById("root")).render(r.jsx(te.StrictMode,{children:r.jsx(ie,{})}));
